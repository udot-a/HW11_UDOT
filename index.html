<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="./css/reset.css">
    <link rel="stylesheet" href="./css/main.css">
    <title>HW11_UDOT</title>
</head>

<body class="wrapper">
    <div class="block-scheme">
        <h1>Required</h1>
        <div id="required">
            <button id='readFile'>Read File</button>
        </div>
    </div>
    <div class="block-scheme">
            <h1>Additional</h1>
            <div id="additonalOne">
                <pre>
                        var messages = [
                        "backspace",
                        "enter",
                        "shift",
                        "control",
                        "delete",
                        "space",
                        "subtract",
                        "turn left",
                        "turn right",
                        "turn down",
                        "turn up"
                    ]
                    getKey = () => {
                        let counter = 1;
                        let key = new Date().toLocaleTimeString()
                        for (let i in log) i.split('[')[0] === key && counter++
                        return counter > 1 ? `${key}[${counter}]` : key
                    }
                    var log = {}
                    var sendMessage = message => new Promise(
                        resolve => setTimeout(
                            () => resolve(message),
                            Math.random() * 7000
                        )
                    )
                    messages.forEach (
                        message => {sendMessage ( message)
                            .then( message =>  
                                Object.assign(log,{[getKey()]:message}))
                    
                        }
                    ) 
                </pre>
            </div>
        </div>
    
    <div class="block-scheme">
        <h1 class='black'>Additional #2</h1>
        <div id="additonalTwo">
            <pre>
                var messages = [
                "backspace",
                "enter",
                "shift",
                "control",
                "delete",
                "space",
                "subtract",
                "turn left",
                "turn right",
                "turn down",
                "turn up"
            ]
            getKey = () => {
                let counter = 1;
                let key = new Date().toLocaleTimeString()
                for (let i in log) i.split('[')[0] === key && counter++
                return counter > 1 ? `${key}[${counter}]` : key
            }
            var log = {}
            var sendMessage = message => new Promise(
                resolve => setTimeout(
                    () => resolve(message),
                    Math.random() * 7000
                )
            )
            var sendAll = () => {
                var index = 0
                function recursive() {
                    let message = messages[index]
                    index++ < messages.length ?
                        sendMessage(message)
                            .then(message => {
                                Object.assign(log, { [getKey()]: message })
                                recursive()
                            }) : null
                }
                recursive()
            }
            sendAll()
        </pre>
        </div>
    </div>

    <script src="./hw11.js"></script>
</body>

</html>